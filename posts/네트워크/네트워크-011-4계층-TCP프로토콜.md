# [네트워크] 4계층 TCP 프로토콜

## TCP가 하는 일

전송 제어 프로토콜 (Transmission Control Protocol)은 인터넷에 연결된 컴퓨터에서 실해되는 프로그램 간에 통신을 **안정적으로, 순서대로, 에러 없이** 교환할 수 있게 한다.

TCP의 안정성을 필요로 하지 않는 애플리케이션의 경우 일반적으로 TCP 대신 비접속형 데이터그램 프로토콜 UDP를 사용한다. TCP는 UDP보다 안전하지만 느리다.

## TCP 프로토콜의 구조

![](/assets/img/posts/네트워크/011-01.jpg)

- Source Port (2 바이트): 출발지 포트
- Destination Port (2 바이트): 도착지 포트
- Offset (4 비트): 헤더의 길이 / 4
- Reserved (4 비트): 예약어. 사용되지 않음
- TCP Flags (1 바이트)
    
     - U (Urgent): 긴급한 데이터의 우선 순위를 높여 긴급하게 전달하는 플래그
     - A (Acknowledgement): 패킷을 잘 전달 받았다고 알려주기 위한 플래그
     - P (Push): 버퍼가 채워지기를 기다리지 않고 즉시 전달하는 플래그
     - R (Reset): 비정상적인 세션을 끊기 위한 플래그
     - S (Synchronization): 통신 시작 시, 세션을 연결하기 위한 플래그
     - F (Finish): 연결 종료 플래그
- Window (2 바이트): 데이터 교환할 때, 의사소통하는 역할. 데이터를 보내도 되는지, 얼만큼 보낼 수 있는지 등등
- Urgent Pointer (2 바이트): U 타입일 때, 사용됨.

## TCP 통신 과정

### 연결 수립 과정

TCP를 이용한 데이터 통신을 할 때, 프로세스와 프로세스를 연결하기 위해 **가장 먼저 수행되는 과정**

1. 클라이언트가 서버에게 요청 패킷을 보낸다. (SYN)
2. 서버가 클라이언트의 요청을 받아들이는 패킷을 보낸다. (SYN + ACK)
3. 클라이언트는 이를 최종적으로 수락하는 패킷을 보낸다. (ACK)

**위 세 과정을 3 Way Handshake라고 한다.**

![](/assets/img/posts/네트워크/011-02.jpg)

### 데이터 송수신 과정

TCP를 이용한 데이터 통신을 할 때, 단순히 TCP 패킷만을 캡슈로하해서 통신하는 것이 아닌 페이로드를 포함한 패킷을 주고 받을 때의 일정한 규칙

1. 보낸 쪽에서 또 보낼 때는 SEQ 번호와 ACK 번호가 그대로다.
2. 받는 쪽에서 SEQ 번호는 받은 ACK 번호가 된다.
3. 받는 쪽에서 ACK 번호는 받은 SEQ 번호 + 데이터의 크기

![](/assets/img/posts/네트워크/011-03.jpg)

- 클라이언트에서 서버에게 보낸 데이터의 크기: 100 바이트
- 서버에서 클라이언트에게 보낸 데이터의 크기: 500 바이트
